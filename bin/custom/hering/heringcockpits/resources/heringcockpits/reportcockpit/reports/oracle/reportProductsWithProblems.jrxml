<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="reportProductsWithProblems" pageWidth="612" pageHeight="792" orientation="Landscape" whenNoDataType="AllSectionsNoDetail" columnWidth="572" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<queryString>
		<![CDATA[SELECT x.styleVariant
     , CASE WHEN SUM(x.stockQuantity) < 1 THEN 'Não' ELSE 'Sim' END AS hasStock
     , CASE WHEN AVG(x.hasMeasurements) < 1 THEN 'Não' ELSE 'Sim' END AS hasMeasurements
     , CASE WHEN AVG(x.hasPrice) < 1 THEN 'Não' ELSE 'Sim' END AS hasPrice
     , CASE WHEN AVG(x.hasImage) < 1 THEN 'Não' ELSE 'Sim' END AS hasImage
FROM ( {{
  SELECT DISTINCT {stylep.code} AS styleVariant
       , {sl.available} AS stockQuantity
       , CASE WHEN {pm.pk} IS NOT NULL THEN 1 ELSE 0 END AS hasMeasurements
       , CASE WHEN {pr.price} > 0 THEN 1 ELSE 0 END AS hasPrice
       , CASE WHEN {p.thumbnail} IS NOT NULL THEN 1 ELSE 0 END AS hasImage
  FROM {Product AS p
        JOIN HeringProduct AS hp ON {hp.code} = {p.code}
        JOIN HeringStyleVariantProduct AS stylep ON {stylep.baseProduct} = {p.pk}
        JOIN HeringSizeVariantProduct AS sizep ON {sizep.baseProduct} = {stylep.pk}
        LEFT OUTER JOIN StockLevel AS sl ON {sl.productcode} = {sizep.code}
        LEFT OUTER JOIN ProductMeasurements AS pm ON {pm.owner} = {p.pk}
        LEFT OUTER JOIN PriceRow AS pr ON {pr.product} = {p.pk}
  }
  WHERE {pm.pk} IS NULL
        OR {pr.price} IS NULL
        OR {p.thumbnail} IS NULL
    }} )  x
GROUP BY x.styleVariant
HAVING SUM(x.stockQuantity) = 0
       OR AVG(x.hasMeasurements) = 0
       OR AVG(x.hasPrice) = 0
       OR AVG(x.hasImage) = 0
ORDER BY x.styleVariant]]>
	</queryString>
	<field name="styleVariant" class="java.lang.String"/>
	<field name="hasStock" class="java.lang.String"/>
	<field name="hasMeasurements" class="java.lang.String"/>
	<field name="hasPrice" class="java.lang.String"/>
	<field name="hasImage" class="java.lang.String"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<pageHeader>
		<band height="52" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="0" width="572" height="32" isPrintWhenDetailOverflows="true"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="26"/>
				</textElement>
				<text><![CDATA[Produtos com Problema]]></text>
			</staticText>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="20">
			<staticText>
				<reportElement mode="Opaque" x="0" y="0" width="158" height="20" isPrintWhenDetailOverflows="true" forecolor="#FFFFFF" backcolor="#000000"/>
				<box>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#FFFFFF"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="11" isBold="true"/>
				</textElement>
				<text><![CDATA[Produto]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="158" y="0" width="103" height="20" isPrintWhenDetailOverflows="true" forecolor="#FFFFFF" backcolor="#000000"/>
				<box>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#FFFFFF"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="11" isBold="true"/>
				</textElement>
				<text><![CDATA[Tem Estoque]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="261" y="0" width="103" height="20" isPrintWhenDetailOverflows="true" forecolor="#FFFFFF" backcolor="#000000"/>
				<box>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#FFFFFF"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="11" isBold="true"/>
				</textElement>
				<text><![CDATA[Tem Medidas]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="364" y="0" width="103" height="20" isPrintWhenDetailOverflows="true" forecolor="#FFFFFF" backcolor="#000000"/>
				<box>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#FFFFFF"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="11" isBold="true"/>
				</textElement>
				<text><![CDATA[Tem Preço]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="467" y="0" width="105" height="20" isPrintWhenDetailOverflows="true" forecolor="#FFFFFF" backcolor="#000000"/>
				<box>
					<topPen lineWidth="1.0" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineColor="#FFFFFF"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="11" isBold="true"/>
				</textElement>
				<text><![CDATA[Tem Imagem]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="18">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToTallestObject" x="0" y="0" width="158" height="18" isPrintWhenDetailOverflows="true"/>
				<box topPadding="2" leftPadding="2" bottomPadding="2" rightPadding="3">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement verticalAlignment="Bottom"/>
				<textFieldExpression><![CDATA[$F{styleVariant}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToTallestObject" x="158" y="0" width="103" height="18" isPrintWhenDetailOverflows="true"/>
				<box topPadding="2" leftPadding="2" bottomPadding="2" rightPadding="3">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement verticalAlignment="Bottom"/>
				<textFieldExpression><![CDATA[$F{hasStock}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToTallestObject" x="261" y="0" width="103" height="18" isPrintWhenDetailOverflows="true"/>
				<box topPadding="2" leftPadding="2" bottomPadding="2" rightPadding="3">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement verticalAlignment="Bottom"/>
				<textFieldExpression><![CDATA[$F{hasMeasurements}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToTallestObject" x="364" y="0" width="103" height="18" isPrintWhenDetailOverflows="true"/>
				<box topPadding="2" leftPadding="2" bottomPadding="2" rightPadding="3">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement verticalAlignment="Bottom"/>
				<textFieldExpression><![CDATA[$F{hasPrice}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToTallestObject" x="467" y="0" width="105" height="18" isPrintWhenDetailOverflows="true"/>
				<box topPadding="2" leftPadding="2" bottomPadding="2" rightPadding="3">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement verticalAlignment="Bottom"/>
				<textFieldExpression><![CDATA[$F{hasImage}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
